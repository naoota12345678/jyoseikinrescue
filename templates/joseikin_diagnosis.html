<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ©æˆé‡‘è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ  - è©³ç´°ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 2rem;
        }
        
        .question {
            margin-bottom: 2rem;
        }
        
        .question h3 {
            margin-bottom: 1rem;
            color: #495057;
        }
        
        .options {
            display: grid;
            gap: 0.5rem;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option:hover {
            border-color: #667eea;
            background-color: #f8f9ff;
        }
        
        .option input {
            margin-right: 0.75rem;
        }
        
        .option.selected {
            border-color: #667eea;
            background-color: #f8f9ff;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 2rem;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .results {
            display: none;
        }
        
        .result-item {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
        }
        
        .result-item h4 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .amount {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ åŠ©æˆé‡‘é©ç”¨è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ </h1>
        
        <div class="card">
            <form id="diagnosisForm">
                <!-- åŸºæœ¬æƒ…å ± -->
                <div class="question">
                    <h3>1. ä¼šç¤¾ã®åŸºæœ¬æƒ…å ±</h3>
                    <label>æ¥­ç¨®:</label>
                    <div class="options">
                        <div class="option" onclick="selectOption(this, 'industry', 'construction')">
                            <input type="radio" name="industry" value="construction"> å»ºè¨­æ¥­
                        </div>
                        <div class="option" onclick="selectOption(this, 'industry', 'manufacturing')">
                            <input type="radio" name="industry" value="manufacturing"> è£½é€ æ¥­
                        </div>
                        <div class="option" onclick="selectOption(this, 'industry', 'service')">
                            <input type="radio" name="industry" value="service"> ã‚µãƒ¼ãƒ“ã‚¹æ¥­
                        </div>
                        <div class="option" onclick="selectOption(this, 'industry', 'it')">
                            <input type="radio" name="industry" value="it"> ITãƒ»é€šä¿¡æ¥­
                        </div>
                        <div class="option" onclick="selectOption(this, 'industry', 'other')">
                            <input type="radio" name="industry" value="other"> ãã®ä»–
                        </div>
                    </div>
                </div>

                <div class="question">
                    <h3>2. å¾“æ¥­å“¡æ•°</h3>
                    <label>ç·å¾“æ¥­å“¡æ•°:</label>
                    <input type="number" name="totalEmployees" placeholder="ä¾‹: 25">
                </div>

                <div class="question">
                    <h3>3. é›‡ç”¨å½¢æ…‹åˆ¥ã®äººæ•°</h3>
                    <label>é›‡ç”¨ä¿é™ºè¢«ä¿é™ºè€…æ•°:</label>
                    <input type="number" name="insuredEmployees" placeholder="ä¾‹: 20"><br><br>
                    <label>æœ‰æœŸå¥‘ç´„åŠ´åƒè€…æ•°:</label>
                    <input type="number" name="temporaryEmployees" placeholder="ä¾‹: 5"><br><br>
                    <label>çŸ­æ™‚é–“åŠ´åƒè€…æ•°ï¼ˆé€±20æ™‚é–“æœªæº€ï¼‰:</label>
                    <input type="number" name="partTimeEmployees" placeholder="ä¾‹: 3">
                </div>

                <div class="question">
                    <h3>4. åŠ´åƒè€…ã®å¹´é½¢æ§‹æˆ</h3>
                    <div class="options">
                        <div class="option" onclick="selectMultiple(this, 'ageGroups')">
                            <input type="checkbox" name="ageGroups" value="young"> 35æ­³æœªæº€ã®è‹¥å¹´è€…ãŒã„ã‚‹
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'ageGroups')">
                            <input type="checkbox" name="ageGroups" value="middle"> 50æ­³ä»¥ä¸Šã®ä¸­é«˜å¹´è€…ãŒã„ã‚‹
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'ageGroups')">
                            <input type="checkbox" name="ageGroups" value="senior"> 60æ­³ä»¥ä¸Šã®é«˜é½¢è€…ãŒã„ã‚‹
                        </div>
                    </div>
                </div>

                <div class="question">
                    <h3>5. ç‰¹åˆ¥ãªé…æ…®ãŒå¿…è¦ãªåŠ´åƒè€…</h3>
                    <div class="options">
                        <div class="option" onclick="selectMultiple(this, 'specialNeeds')">
                            <input type="checkbox" name="specialNeeds" value="disability"> éšœå®³è€…é›‡ç”¨ãŒã‚ã‚‹ãƒ»äºˆå®šãŒã‚ã‚‹
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'specialNeeds')">
                            <input type="checkbox" name="specialNeeds" value="female"> å¥³æ€§åŠ´åƒè€…ã®æ´»èºæ¨é€²
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'specialNeeds')">
                            <input type="checkbox" name="specialNeeds" value="foreign"> å¤–å›½äººåŠ´åƒè€…ãŒã„ã‚‹
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'specialNeeds')">
                            <input type="checkbox" name="specialNeeds" value="singleParent"> æ¯å­ãƒ»çˆ¶å­å®¶åº­ã®åŠ´åƒè€…ãŒã„ã‚‹
                        </div>
                    </div>
                </div>

                <div class="question">
                    <h3>6. ç¾åœ¨ã®çµŒå–¶çŠ¶æ³</h3>
                    <div class="options">
                        <div class="option" onclick="selectOption(this, 'businessSituation', 'declining')">
                            <input type="radio" name="businessSituation" value="declining"> å£²ä¸Šæ¸›å°‘ãƒ»äº‹æ¥­ç¸®å°ã—ã¦ã„ã‚‹
                        </div>
                        <div class="option" onclick="selectOption(this, 'businessSituation', 'stable')">
                            <input type="radio" name="businessSituation" value="stable"> å®‰å®šã—ã¦ã„ã‚‹
                        </div>
                        <div class="option" onclick="selectOption(this, 'businessSituation', 'growing')">
                            <input type="radio" name="businessSituation" value="growing"> æˆé•·ãƒ»æ‹¡å¤§ã—ã¦ã„ã‚‹
                        </div>
                    </div>
                </div>

                <div class="question">
                    <h3>7. è³ƒé‡‘ãƒ»å‡¦é‡ã®çŠ¶æ³</h3>
                    <label>äº‹æ¥­å ´å†…æœ€ä½è³ƒé‡‘ï¼ˆæ™‚çµ¦ï¼‰:</label>
                    <input type="number" name="minWage" placeholder="ä¾‹: 900"><br><br>
                    <div class="options">
                        <div class="option" onclick="selectMultiple(this, 'wageImprovement')">
                            <input type="checkbox" name="wageImprovement" value="raise"> è³ƒé‡‘å¼•ä¸Šã’ã‚’æ¤œè¨ã—ã¦ã„ã‚‹
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'wageImprovement')">
                            <input type="checkbox" name="wageImprovement" value="regularization"> éæ­£è¦ã‚’æ­£ç¤¾å“¡åŒ–ã—ãŸã„
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'wageImprovement')">
                            <input type="checkbox" name="wageImprovement" value="bonus"> è³ä¸åˆ¶åº¦ã‚’å°å…¥ã—ãŸã„
                        </div>
                    </div>
                </div>

                <div class="question">
                    <h3>8. æŠ•è³‡ãƒ»æ”¹å–„ã®äºˆå®š</h3>
                    <div class="options">
                        <div class="option" onclick="selectMultiple(this, 'investments')">
                            <input type="checkbox" name="investments" value="equipment"> è¨­å‚™æŠ•è³‡ãƒ»æ©Ÿå™¨å°å…¥
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'investments')">
                            <input type="checkbox" name="investments" value="training"> è·æ¥­è¨“ç·´ãƒ»ç ”ä¿®å®Ÿæ–½
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'investments')">
                            <input type="checkbox" name="investments" value="it"> ITåŒ–ãƒ»DXæ¨é€²
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'investments')">
                            <input type="checkbox" name="investments" value="workStyle"> åƒãæ–¹æ”¹é©ï¼ˆãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯ç­‰ï¼‰
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'investments')">
                            <input type="checkbox" name="investments" value="safety"> å®‰å…¨è¡›ç”Ÿå¯¾ç­–
                        </div>
                    </div>
                </div>

                <div class="question">
                    <h3>9. ä¸¡ç«‹æ”¯æ´ãƒ»è·å ´ç’°å¢ƒ</h3>
                    <div class="options">
                        <div class="option" onclick="selectMultiple(this, 'workLifeBalance')">
                            <input type="checkbox" name="workLifeBalance" value="childcare"> è‚²å…æ”¯æ´åˆ¶åº¦ã‚’å……å®Ÿã•ã›ãŸã„
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'workLifeBalance')">
                            <input type="checkbox" name="workLifeBalance" value="eldercare"> ä»‹è­·æ”¯æ´åˆ¶åº¦ã‚’å……å®Ÿã•ã›ãŸã„
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'workLifeBalance')">
                            <input type="checkbox" name="workLifeBalance" value="health"> å¥åº·çµŒå–¶ã‚’æ¨é€²ã—ãŸã„
                        </div>
                        <div class="option" onclick="selectMultiple(this, 'workLifeBalance')">
                            <input type="checkbox" name="workLifeBalance" value="smoking"> å—å‹•å–«ç…™é˜²æ­¢å¯¾ç­–ãŒå¿…è¦
                        </div>
                    </div>
                </div>

                <button type="button" onclick="diagnose()">ğŸ“‹ åŠ©æˆé‡‘è¨ºæ–­ã‚’å®Ÿè¡Œ</button>
            </form>
        </div>

        <div class="card results" id="results">
            <h2>ğŸ¯ è¨ºæ–­çµæœ</h2>
            <div id="resultsList"></div>
        </div>
    </div>

    <script>
        function selectOption(element, name, value) {
            // åŒã˜nameå±æ€§ã®ä»–ã®é¸æŠè‚¢ã‚’éé¸æŠçŠ¶æ…‹ã«
            document.querySelectorAll(`input[name="${name}"]`).forEach(input => {
                input.closest('.option').classList.remove('selected');
                input.checked = false;
            });
            
            // é¸æŠã•ã‚ŒãŸé …ç›®ã‚’é¸æŠçŠ¶æ…‹ã«
            element.classList.add('selected');
            element.querySelector('input').checked = true;
        }

        function selectMultiple(element, name) {
            const input = element.querySelector('input');
            input.checked = !input.checked;
            element.classList.toggle('selected');
        }

        async function diagnose() {
            const formData = new FormData(document.getElementById('diagnosisForm'));
            const data = {};
            
            // åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã®åé›†
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            displayLoading();

            try {
                // Claude AIã«è¨ºæ–­ã‚’ä¾é ¼
                const response = await fetch('/api/joseikin-diagnosis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        diagnosis_data: data
                    })
                });

                const result = await response.json();
                
                if (result.status === 'success') {
                    displayResults(result.applicable_grants);
                } else {
                    displayError('è¨ºæ–­ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + result.error);
                }
                
            } catch (error) {
                console.error('è¨ºæ–­ã‚¨ãƒ©ãƒ¼:', error);
                displayError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            }
        }

        function displayLoading() {
            const resultsDiv = document.getElementById('results');
            const resultsList = document.getElementById('resultsList');
            
            resultsList.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="animation: spin 1s linear infinite; width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; margin: 0 auto 1rem;"></div>
                    <p>AIå°‚é–€å®¶ãŒå…¨29ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®åŠ©æˆé‡‘ã‚’è¨ºæ–­ä¸­...</p>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">ä»¤å’Œ7å¹´åº¦ã®æœ€æ–°æƒ…å ±ã§åˆ¤å®šã—ã¦ã„ã¾ã™</p>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
            
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function displayError(message) {
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = `<div style="color: #e74c3c; text-align: center; padding: 2rem;">${message}</div>`;
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            const resultsList = document.getElementById('resultsList');
            
            if (results.length === 0) {
                resultsList.innerHTML = '<p>ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ç¾åœ¨ã®æ¡ä»¶ã§ã¯è©²å½“ã™ã‚‹åŠ©æˆé‡‘ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚æ¡ä»¶ã‚’è¦‹ç›´ã™ã‹ã€å€‹åˆ¥ç›¸è«‡ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>';
            } else {
                resultsList.innerHTML = results.map(result => `
                    <div class="result-item">
                        <h4>${result.name}</h4>
                        <p>${result.description}</p>
                        <p class="amount">ğŸ’° æ”¯çµ¦é¡: ${result.amount}</p>
                        <p><strong>å¯¾è±¡è¦ä»¶:</strong> ${result.eligibility}</p>
                        <p><strong>å°‚é–€ç›¸è«‡:</strong> ${result.specialist}</p>
                    </div>
                `).join('');
            }
            
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>