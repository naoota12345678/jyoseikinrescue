# 助成金レスキュー プロンプトエンジニアリングガイド

このファイルは、助成金AIエージェントのプロンプト設計における重要なノウハウを管理します。
申請書の内容は変更されても、これらの前提理解は変わらない普遍的な知識です。

## 📅 助成金申請における時系列理解（最重要）

### 基本原則
助成金申請には必ず以下の3つの時点が存在します：
1. **計画申請時点** - 助成金を申請する現在の時点
2. **実施期間** - 計画を実行する期間
3. **支給申請時点** - 実施完了後に支給を申請する時点

### よくある誤解パターンと対処法

#### 1. 「〜にします」「〜する予定」の理解
**誤解例**：
- ユーザー：「賃金を1010円から1075円にします」
- AI誤答：「既に1075円になっているので対象外」

**正しい理解**：
```
【将来形の表現判定】
・「〜にします」「〜する予定」「〜を計画」「〜したい」
  → これから実施する（計画申請時点では未実施）
・「〜しました」「〜になっています」「現在〜です」
  → 既に実施済み

【判定ロジック】
計画申請時点の状態 = 現在の状態
実施後の状態 = 将来の計画
差額・変化 = 助成金の対象
```

#### 2. 基準日の明確化
**誤解例**：
- ユーザー：「4月から正社員にする」
- AI誤答：「現在の状態が不明」

**正しい対応**：
```
【時点確認の質問例】
「確認させてください：
- 現在（計画申請時点）の状態は？
- いつから変更予定ですか？
- 変更後はどうなりますか？」
```

### 助成金タイプ別の時系列パターン

#### A. 事前申請型（計画→実施→支給申請）
- 業務改善助成金
- キャリアアップ助成金
```
時系列：計画申請 → 承認 → 実施 → 完了報告 → 支給
重要：計画申請前に実施してはいけない
```

#### B. 事後申請型（実施→申請）
- 一部の緊急対応助成金
```
時系列：実施 → 申請 → 審査 → 支給
重要：実施時期の証明が必要
```

## 🔢 数値・金額の扱い

### 差分計算の原則
```
【増額・改善系の助成金】
助成対象額 = 実施後 - 実施前
例：賃金引上げ額 = 新賃金 - 旧賃金

【導入系の助成金】
助成対象 = 新規導入したもの
例：制度がない → 制度導入 = 対象
```

### 比較基準の明確化
```
【比較時点の確認】
必ず以下を明確にする：
1. 比較の基準日はいつか
2. 「以上」「未満」「超える」の境界値
3. 継続期間の要件
```

## 📝 専門用語の正確な解釈

### 論理演算子の厳密な理解
```
・「AかつB」「AおよびB」 = 両方必要（AND）
・「AまたはB」「AもしくはB」 = どちらか一方（OR）
・「A以上B以下」 = A ≤ X ≤ B（境界含む）
・「Aを超えBまで」 = A < X ≤ B（下限含まず）
```

### 対象者の定義
```
【雇用形態の時系列】
・「有期雇用労働者」→ 転換前の状態
・「正社員転換後」→ 転換後の状態
・「転換日」→ 状態が変わる境界

【判定ポイント】
どの時点での状態を問われているか常に確認
```

## 🚫 避けるべきプロンプトパターン

### 1. 曖昧な時制
❌ 悪い例：「賃金が1075円の場合」
✅ 良い例：「現在1010円で、1075円に引き上げる場合」

### 2. 状態変化の仮定
❌ 悪い例：「既に実施されているものとして」
✅ 良い例：「これから実施する計画として」

## 📂 実装方法

### claude_service.pyへの組み込み
```python
# 共通プロンプト定数として定義
TIMELINE_UNDERSTANDING = """
【助成金申請の時系列理解 - 最重要】
質問者が「これから〜する予定」「〜にします」と言った場合：
→ これは将来の計画であり、まだ実施していない
→ 計画申請時点では「実施前」として扱う
→ 「既に実施済み」と誤解しない

【状態変化の確認】
常に以下の3時点を区別：
1. 現在の状態（計画申請時点）
2. 実施中の状態
3. 完了後の状態（支給申請時点）
"""

# 各エージェントのプロンプトに組み込み
def get_common_prompt_base():
    return TIMELINE_UNDERSTANDING + LOGICAL_OPERATORS + ...
```

## 📈 今後の拡張

### 追加すべき時系列パターン
1. **遡及適用の判断**
   - 「4月1日から適用」の解釈
   - 過去に遡っての申請可否

2. **並行実施の扱い**
   - 複数の改善を同時実施
   - 段階的実施の扱い

3. **中断・変更の扱い**
   - 計画変更申請のタイミング
   - 中止した場合の扱い

## 🔄 更新履歴
- 2025-01-04: 初版作成 - 時系列理解の基本原則を整理
- （今後の更新はここに記録）

---
**注意**: このガイドは要綱の内容とは独立した、AIの理解力向上のためのノウハウです。
要綱が変更されても、これらの理解原則は維持されるべきです。